import{_ as d,o as a,c as l,a as e,b as t,d as n,e as i,r}from"./app.f6b99883.js";const u={},o=n(`<h1 id="_1-\u8FDE\u63A5\u6570\u636E\u5E93" tabindex="-1"><a class="header-anchor" href="#_1-\u8FDE\u63A5\u6570\u636E\u5E93" aria-hidden="true">#</a> 1. \u8FDE\u63A5\u6570\u636E\u5E93</h1><p>\u901A\u8FC7\u4F9D\u8D56\u6CE8\u5165\u914D\u7F6E\u5E94\u7528\u7A0B\u5E8F\uFF0C\u901A\u8FC7startup\u7C7B\u7684ConfigureService\u65B9\u6CD5\u4E2D\u7684AddDbContext\u5C06EFCore\u6DFB\u52A0\u5230\u4F9D\u8D56\u6CE8\u5165\u5BB9\u5668</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>public void ConfigureServices(IServiceCollection services)
{
    services.AddControllers();

    services.AddDbContext&lt;OpenDbContext&gt;(
        options =&gt; options.UseMySql(Configuration[&quot;DbConfig:Mysql:ConnectionString&quot;]);
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5C06\u540D\u4E3A OpenDbContext\u7684 DbContext \u5B50\u7C7B\u6CE8\u518C\u5230\u4F9D\u8D56\u6CE8\u5165\u5BB9\u5668\u7684Scope\u751F\u547D\u5468\u671F\u3002\u4E0A\u4E0B\u6587\u914D\u7F6E\u4E3A\u4F7F\u7528MySQL\u6570\u636E\u5E93\u63D0\u4F9B\u7A0B\u5E8F\uFF0C\u5E76\u4ECE\u914D\u7F6E\u4E2D\u8BFB\u53D6\u6570\u636E\u5E93\u8FDE\u63A5\u5B57\u7B26\u4E32\u3002</p><p>OpenDbContext\u7C7B\u5FC5\u987B\u516C\u5F00\u5177\u6709 DbContextOptions&lt;OpenDbContext&gt;\u53C2\u6570\u7684\u516C\u5171\u6784\u9020\u51FD\u6570\u3002 \u8FD9\u662F\u5C06 AddDbContext \u7684\u4E0A\u4E0B\u6587\u914D\u7F6E\u4F20\u9012\u5230 DbContext \u7684\u65B9\u5F0F\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    public class OpenDbContext : DbContext
    {
        public OpenDbContext(DbContextOptions options) : base(options)
        {
        }

        public DbSet&lt;User&gt; Users { get; set; }
        public DbSet&lt;Score&gt; Scores { get; set; }

        protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
        {
            //\u53E6\u4E00\u79CD\u914D\u7F6E\u8FDE\u63A5\u6570\u636E\u5E93\u7684\u65B9\u5F0F
            //optionsBuilder.UseMySql(&quot;\u8FDE\u63A5\u6570\u636E\u5E93&quot;, ServerVersion.AutoDetect(&quot;\u8FDE\u63A5\u6570\u636E\u5E93\u5B57\u7B26\u4E32&quot;));
            
            //\u663E\u793A\u654F\u611F\u6570\u636E\u65E5\u5FD7
            optionsBuilder.EnableSensitiveDataLogging(true);
        }

        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            //\u5C5E\u6027\u914D\u7F6E
            //modelBuilder.Entity&lt;User&gt;().Property(t =&gt; t.Account).IsRequired().HasMaxLength(20).HasComment(&quot;\u5E10\u53F7&quot;);
            //\u79CD\u5B50\u6570\u636E\u8BBE\u7F6E
            //modelBuilder.Entity&lt;User&gt;().HasData(new User { Account=&quot;\u79CD\u5B50&quot;});
            
            // \u6DFB\u52A0etc
            modelBuilder.ApplyConfiguration(new UserInfoETC());

            //\u901A\u8FC7\u53CD\u5C04\u6279\u91CF\u6DFB\u52A0etc\u7684\u64CD\u4F5C
            modelBuilder.ApplyConfigurationsFromAssembly(Assembly.GetExecutingAssembly());

            base.OnModelCreating(modelBuilder);
        }
    }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7136\u540E\u5C06OpenDbContext\u901A\u8FC7\u6784\u9020\u51FD\u6570\u6CE8\u5165\u7684\u65B9\u5F0F\u6CE8\u5165\u5230\u5E94\u7528\u7A0B\u5E8F\u7684\u63A7\u5236\u5668\u6216\u8005\u5176\u4ED6\u670D\u52A1\u4E2D\u4F7F\u7528\u3002</p>`,7),c=i("\u5173\u4E8E\u8FDE\u63A5\u6570\u636E\u5E93\u53EF\u4EE5\u53C2\u8003\u53E6\u4E00\u4E2A\u6587\u7AE0\uFF1A "),v={href:"https://mp.weixin.qq.com/s/_jfMwvewRNkAVwL4pfvLCA",target:"_blank",rel:"noopener noreferrer"},m=i(".Net\u4E4B\u751F\u6210\u6570\u636E\u5E93\u5168\u6D41\u7A0B"),b=n(`<h1 id="_2-\u64CD\u4F5C\u6570\u636E\u5E93" tabindex="-1"><a class="header-anchor" href="#_2-\u64CD\u4F5C\u6570\u636E\u5E93" aria-hidden="true">#</a> 2. \u64CD\u4F5C\u6570\u636E\u5E93</h1><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    context.Database.EnsureDeleted();//\u5220\u9664\u6570\u636E\u5E93\uFF0C\u5982\u679C\u5B58\u5728\uFF0C\u5982\u679C\u6CA1\u6709\u6743\u9650\uFF0C\u5219\u5F15\u53D1\u5F02\u5E38
    context.Database.EnsureCreated();//\u5982\u679C\u6570\u636E\u5E93\u4E0D\u5B58\u5728\uFF0C\u521B\u5EFA\u6570\u636E\u5E93\u5E76\u521D\u59CB\u5316\u6570\u636E\u5E93\u67B6\u6784\uFF0C\u5982\u679C\u5B58\u5728\u4EFB\u4F55\u8868\uFF0C\u5219\u4E0D\u4F1A\u521D\u59CB\u5316\u67B6\u6784
    context.Database.Migrate();//\u6839\u636E\u8FC1\u79FB\u6587\u4EF6\uFF0C\u8FC1\u79FB\u6570\u636E\u5E93
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_3-\u67E5\u8BE2\u64CD\u4F5C" tabindex="-1"><a class="header-anchor" href="#_3-\u67E5\u8BE2\u64CD\u4F5C" aria-hidden="true">#</a> 3. \u67E5\u8BE2\u64CD\u4F5C</h1><h2 id="_3-1-\u57FA\u7840\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#_3-1-\u57FA\u7840\u67E5\u8BE2" aria-hidden="true">#</a> 3.1 \u57FA\u7840\u67E5\u8BE2</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>db.Set&lt;UserInfor&gt;().ToList();

//\u67E5\u8BE2\u8868\u8FBE\u5F0F
var account = (from u in _context.Users
                    where u.Id == id
                    select u.Account
                    ).ToList();

//\u67E5\u8BE2\u5355\u4E2A
_context.Movie.FirstOrDefaultAsync(m =&gt; m.ID == id); 
_context.Movie.FindAsync(id); 

//\u67E5\u8BE2\u6307\u5B9A\u5217  \u5982\u679C\u4E0D\u5B58\u5728\u6570\u636E\u8FD4\u56DE\u7A7A\u5BF9\u8C61\uFF0C\u800C\u4E0D\u662Fnull
_context.Set&lt;User&gt;().AsNoTracking().Where(t=&gt;t.Id==&quot;11&quot;).Select(t =&gt; new { t.Account, t.PassWord }).FirstOrDefaultAsync();
//\u67E5\u8BE2\u6307\u5B9A\u5217 \u5982\u679C\u4E0D\u5B58\u5728\u6570\u636E\u8FD4\u56DE\u7A7A\u5B57\u7B26\u4E32\uFF0C\u800C\u4E0D\u662Fnull
 var session = await _context.Set&lt;User&gt;().Where(t=&gt;t.Id ==&quot;11&quot;).Select(t =&gt; t.Name).FirstOrDefaultAsync().ConfigureAwait(false);

_context.Users.OrderBy(ty =&gt; ty.IsValid).Where(t =&gt; t.Id == &quot;1407875772521123840&quot;).FirstOrDefaultAsync();
// \u5728EFCore\u4E2D\u4E0D\u8BBA\u662F\u5148where\u8FD8\u662F\u5148order\uFF0C\u751F\u6210\u7684SQL\u811A\u672C\u90FD\u662F\u5148where\u518Dorder\u7684

// \u9884\u5148\u52A0\u8F7D\u67E5\u8BE2
var blogs = context.Blogs.Include(blog =&gt; blog.Posts).ToList();
// \u5305\u542B\u591A\u4E2A\u5C42\u7EA7\u7684\u67E5\u8BE2
var blogs = context.Blogs.Include(blog =&gt; blog.Posts).ThenInclude(post =&gt; post.Author).ToList();
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>SingleOrDefaultAsync \u4E0EFirstOrDefaultAsync</p><p>\u5982\u679C\u6709\u591A\u4E2A\u5B9E\u4F53\u7B26\u5408\u7B5B\u9009\u90E8\u5206\uFF0C SingleOrDefaultAsync \u5C06\u5F15\u53D1\u5F02\u5E38\u3002</p><p>\u5982\u679C\u6709\u591A\u4E2A\u5B9E\u4F53\u7B26\u5408\u7B5B\u9009\u90E8\u5206\uFF0C FirstOrDefaultAsync \u4E0D\u5F15\u53D1\u5F02\u5E38\u3002</p><p>FindAsync</p><p>\u5728\u5927\u90E8\u5206\u57FA\u67B6\u4EE3\u7801\u4E2D\uFF0CFindAsync \u53EF\u7528\u4E8E\u66FF\u4EE3 FirstOrDefaultAsync \uFF0C\u67E5\u627E\u5177\u6709\u4E3B\u952E (PK) \u7684\u5B9E\u4F53\u3002 \u5982\u679C\u5177\u6709 PK \u7684\u5B9E\u4F53\u6B63\u5728\u7531\u4E0A\u4E0B\u6587\u8DDF\u8E2A\uFF0C\u4F1A\u8FD4\u56DE\u8BE5\u5B9E\u4F53\u4E14\u4E0D\u5411 DB \u53D1\u51FA\u8BF7\u6C42\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u6D4B\u8BD5\u7ED3\u679C
var entity = _context.Users.Where(t =&gt; t.Id == &quot;55555&quot;).Select(t =&gt; new { t.Account }).FirstOrDefault();//null
var entity2 = _context.Users.Where(t =&gt; t.Id == &quot;55555&quot;).Select(t =&gt; t.Account).FirstOrDefault();//null
var enetit3 = _context.Users.Where(t =&gt; t.Id == &quot;55555&quot;).Select(t =&gt; new user { Name = t.Account }).FirstOrDefault();//null
var entity4 = _context.Users.FirstOrDefault(t =&gt; t.Id == &quot;55555&quot;);//null
var entity5 = _context.Users.Select(t =&gt; new user { Name = t.Account }).FirstOrDefault(t =&gt; t.Name == &quot;444&quot;);//null
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-2-\u8DDF\u8E2A\u548C\u975E\u8DDF\u8E2A\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#_3-2-\u8DDF\u8E2A\u548C\u975E\u8DDF\u8E2A\u67E5\u8BE2" aria-hidden="true">#</a> 3.2 \u8DDF\u8E2A\u548C\u975E\u8DDF\u8E2A\u67E5\u8BE2</h2><p>\u8DDF\u8E2A\u884C\u4E3A\u51B3\u5B9A\u4E86EFCore\u662F\u5426\u5C06\u6709\u4E9B\u5B9E\u4F53\u7684\u4FE1\u606F\u4FDD\u5B58\u5728\u5176\u66F4\u6539\u66F4\u8DDF\u8E2A\u5668\u4E2D\u3002\u5982\u679C\u5DF2\u8DDF\u8E2A\u67D0\u4E2A\u5B9E\u4F53\uFF0C\u5219\u8BE5\u5B9E\u4F53\u4E2D\u68C0\u6D4B\u5230\u7684\u4EFB\u4F55\u66F4\u6539\u90FD\u4F1A\u5728SaveChanges()\u65F6\u5019\u4FDD\u5B58\u5230\u6570\u636E\u5E93\uFF0C</p><p>\u4E0D\u8DDF\u8E2A\u6CA1\u6709\u4E3B\u952E\u7684\u5B9E\u4F53\u7C7B\u578B\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># \u8DDF\u8E2A\u67E5\u8BE2
_context.Set&lt;User&gt;().ToListAsync();

# \u975E\u8DDF\u8E2A\u67E5\u8BE2
_context.Set&lt;User&gt;().AsNoTracking().ToListAsync();
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u9ED8\u8BA4\u662F\u8DDF\u8E2A\u67E5\u8BE2</p><h2 id="_3-3-\u6761\u4EF6\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#_3-3-\u6761\u4EF6\u67E5\u8BE2" aria-hidden="true">#</a> 3.3 \u6761\u4EF6\u67E5\u8BE2</h2><h3 id="_3-3-1-\u4E0D\u652F\u6301\u5F02\u6B65\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#_3-3-1-\u4E0D\u652F\u6301\u5F02\u6B65\u65B9\u6848" aria-hidden="true">#</a> 3.3.1 \u4E0D\u652F\u6301\u5F02\u6B65\u65B9\u6848</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>			Func&lt;User, bool&gt; express = x =&gt; true;		
            if (!string.IsNullOrWhiteSpace(dto.Data))
            {
                express = x =&gt; x.Mobile == dto.Data;
            }
            string userid = &quot;&quot;;
            if (!string.IsNullOrWhiteSpace(userid))
            {
                express = x =&gt; x.UserId == userid;
            }
            var bbb = _dbContext.Set&lt;User&gt;().Where(express).FirstOrDefault();
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-2-\u652F\u6301\u5F02\u6B65\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#_3-3-2-\u652F\u6301\u5F02\u6B65\u65B9\u6848" aria-hidden="true">#</a> 3.3.2 \u652F\u6301\u5F02\u6B65\u65B9\u6848</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>			Expression&lt;Func&lt;User, bool&gt;&gt; express = x =&gt; true;
            if (!string.IsNullOrWhiteSpace(dto.Data))
            {
                express = x =&gt; x.Mobile == dto.Data;
            }
            var bbb = await _dbContext.Set&lt;User&gt;().Where(express).ToListAsync();
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-4-\u539F\u751Fsql\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#_3-4-\u539F\u751Fsql\u67E5\u8BE2" aria-hidden="true">#</a> 3.4 \u539F\u751FSQL\u67E5\u8BE2</h2><p>\u53EF\u4F7F\u7528 FromSqlRaw \u6269\u5C55\u65B9\u6CD5\u57FA\u4E8E\u539F\u59CB SQL \u67E5\u8BE2\u5F00\u59CB LINQ \u67E5\u8BE2\u3002 FromSqlRaw \u53EA\u80FD\u5728\u76F4\u63A5\u4F4D\u4E8E DbSet&lt;&gt; \u4E0A\u7684\u67E5\u8BE2\u6839\u4E0A\u4F7F\u7528\u3002</p><h3 id="_3-4-1-\u57FA\u672C\u539F\u751Fsql\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#_3-4-1-\u57FA\u672C\u539F\u751Fsql\u67E5\u8BE2" aria-hidden="true">#</a> 3.4.1 \u57FA\u672C\u539F\u751FSQL\u67E5\u8BE2</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>var blogs = context.Blogs
    .FromSqlRaw(&quot;select * from user&quot;)
    .ToList();

// \u6267\u884C\u5B58\u50A8\u8FC7\u7A0B
var blogs = context.Blogs
    .FromSqlRaw(&quot;EXECUTE dbo.GetMostPopularBlogs&quot;)
    .ToList();
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2.x\u91CC\u9762\u4F7F\u7528FromSql\uFF0C\u57283.x\u91CC\u9762\u4F7F\u7528FromSqlRow\u65B9\u6CD5</p><h3 id="_3-4-2-\u53C2\u6570\u5316\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#_3-4-2-\u53C2\u6570\u5316\u67E5\u8BE2" aria-hidden="true">#</a> 3.4.2 \u53C2\u6570\u5316\u67E5\u8BE2</h3><h4 id="_3-4-2-1-sql\u6CE8\u5165" tabindex="-1"><a class="header-anchor" href="#_3-4-2-1-sql\u6CE8\u5165" aria-hidden="true">#</a> 3.4.2.1 SQL\u6CE8\u5165</h4><p>\u9996\u5148\u6211\u4EEC\u7F16\u5199\u4E00\u4E2A\u7B80\u5355\u7684SQL\u6CE8\u5165\u793A\u4F8B\uFF0C\u6BD4\u5982\u5C31\u6CE8\u5165\u6211\u4EEC\u6839\u636EID\u67E5\u8BE2\u7684\u8BED\u53E5\uFF0C\u8F93\u5165ID\u4E3A\uFF1Aididid&#39; or &#39;1&#39;=&#39;1</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    var strSql = string.Format(&quot;select * from user where Id=&#39;{0}&#39;&quot;, &quot;ididid&#39; or &#39;1&#39;=&#39;1&quot;);
    var query = await _context.Set&lt;User&gt;().FromSqlRaw(strSql).ToListAsync();
    Console.WriteLine(JsonConvert.SerializeObject(query));
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u751F\u6210\u8BED\u53E5</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>      select * from user where Id=&#39;ididid&#39; or &#39;1&#39;=&#39;1&#39;
[{&quot;Account&quot;:&quot;\u5F20\u4E09&quot;,&quot;PassWord&quot;:&quot;123456&quot;,&quot;CreateTime&quot;:&quot;2021-05-20T22:53:44.778101&quot;,&quot;IsValid&quot;:false,&quot;Id&quot;:&quot;1395392302788120576&quot;},{&quot;Account&quot;:&quot;\u674E\u56DB&quot;,&quot;PassWord&quot;:&quot;123456&quot;,&quot;CreateTime&quot;:&quot;2021-05-20T22:53:44.849376&quot;,&quot;IsValid&quot;:false,&quot;Id&quot;:&quot;1395392303090110464&quot;},{&quot;Account&quot;:&quot;\u738B\u4E94&quot;,&quot;PassWord&quot;:&quot;123456&quot;,&quot;CreateTime&quot;:&quot;2021-05-20T22:53:44.849425&quot;,&quot;IsValid&quot;:false,&quot;Id&quot;:&quot;1395392303090110467&quot;}]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-4-2-2-fromsqlraw\u53C2\u6570\u5316" tabindex="-1"><a class="header-anchor" href="#_3-4-2-2-fromsqlraw\u53C2\u6570\u5316" aria-hidden="true">#</a> 3.4.2.2 FromSqlRaw\u53C2\u6570\u5316</h4><p>\u901A\u8FC7\u53C2\u6570\u5316\u67E5\u8BE2\uFF0C\u9632\u6B62SQL\u6CE8\u5165\u95EE\u9898</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    //sql\u8BED\u53E5\u53C2\u6570\u5316\u67E5\u8BE2\uFF0C\u9632\u6B62SQL\u6CE8\u5165	
    var strSql = &quot;select * from user where Id=@id&quot;;
    var parameter = new MySqlParameter[] {
        new MySqlParameter(&quot;@id&quot;,&quot;1395392302788120576&quot;),
    };
    var query = await _context.Set&lt;User&gt;().FromSqlRaw(strSql, parameter).ToListAsync();
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6216\u8005</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    var strSql = &quot;select * from user where Id={0}&quot;;
    var query = await _context.Set&lt;User&gt;().FromSqlRaw(strSql, &quot;1395392302788120576&quot;).ToListAsync();
    Console.WriteLine(JsonConvert.SerializeObject(query));
	
	// \u751F\u6210SQL
    select * from user where Id=@p0
    [{&quot;Account&quot;:&quot;\u5F20\u4E09&quot;,&quot;PassWord&quot;:&quot;123456&quot;,&quot;CreateTime&quot;:&quot;2021-05-20T22:53:44.778101&quot;,&quot;IsValid&quot;:false,&quot;Id&quot;:&quot;1395392302788120576&quot;}]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u901A\u8FC7\u5360\u4F4D\u7B26\u5F62\u5F0F\u63D0\u4F9B\u989D\u5916\u7684\u53C2\u6570\uFF0C\u770B\u4E0A\u53BB\u7C7B\u4F3C\u4E8EString.Format\u8BED\u6CD5\uFF0C\u4F46\u662F\u63D0\u4F9B\u7684\u503C\u5305\u88C5\u5728DbParameter\u4E2D\u3002\u53EF\u4EE5\u9632\u6B62SQL\u6CE8\u5165</p><h4 id="_3-4-2-3-fromsqlinterpolated\u53C2\u6570\u5316" tabindex="-1"><a class="header-anchor" href="#_3-4-2-3-fromsqlinterpolated\u53C2\u6570\u5316" aria-hidden="true">#</a> 3.4.2.3 FromSqlInterpolated\u53C2\u6570\u5316</h4><p>FromSqlInterpolated \u7C7B\u4F3C\u4E8E FromSqlRaw\uFF0C\u4F46\u4F60\u53EF\u4EE5\u501F\u52A9\u5B83\u4F7F\u7528\u5B57\u7B26\u4E32\u5185\u63D2\u8BED\u6CD5\u3002 \u4E0E FromSqlRaw \u4E00\u6837\uFF0CFromSqlInterpolated \u53EA\u80FD\u5728\u67E5\u8BE2\u6839\u4E0A\u4F7F\u7528\uFF0C\u5E76\u4E14\u90FD\u53EF\u4EE5\u9632\u6B62SQL\u6CE8\u5165\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    var query = await _context.Set&lt;User&gt;().FromSqlInterpolated($&quot;select * from user where Id={&quot;1395392302788120576&quot;}&quot;).ToListAsync();
    Console.WriteLine(JsonConvert.SerializeObject(query));
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u751F\u6210SQL</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>      select * from user where Id=@p0
[{&quot;Account&quot;:&quot;\u5F20\u4E09&quot;,&quot;PassWord&quot;:&quot;123456&quot;,&quot;CreateTime&quot;:&quot;2021-05-20T22:53:44.778101&quot;,&quot;IsValid&quot;:false,&quot;Id&quot;:&quot;1395392302788120576&quot;}]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-3-\u9650\u5236" tabindex="-1"><a class="header-anchor" href="#_3-4-3-\u9650\u5236" aria-hidden="true">#</a> 3.4.3 \u9650\u5236</h3>`,44),p=e("li",null,[e("p",null,"SQL\u67E5\u8BE2\u5FC5\u987B\u8FD4\u56DE\u5B9E\u4F53\u7C7B\u578B\u7684\u6240\u6709\u5C5E\u6027\u7684\u6570\u636E\u3002")],-1),g=e("li",null,[e("p",null,"\u7ED3\u679C\u96C6\u4E2D\u7684\u5217\u660E\u5FC5\u987B\u4E0E\u5C5E\u6027\u6620\u5C04\u5230\u7684\u5217\u540D\u79F0\u5339\u914D\u3002")],-1),h=i("SQL\u67E5\u8BE2\u4E0D\u80FD\u5305\u542B\u5173\u8054\u6570\u636E\uFF0C \u4F46\u662F\uFF0C\u5728\u8BB8\u591A\u60C5\u51B5\u4E0B\u4F60\u53EF\u4EE5\u5728\u67E5\u8BE2\u540E\u9762\u7D27\u8DDF\u7740\u4F7F\u7528 "),q=e("code",null,"Include",-1),x=i(" \u65B9\u6CD5\u4EE5\u8FD4\u56DE\u5173\u8054\u6570\u636E\uFF08\u8BF7\u53C2\u9605"),f={href:"https://docs.microsoft.com/zh-cn/ef/core/querying/raw-sql#including-related-data",target:"_blank",rel:"noopener noreferrer"},_=i("\u5305\u542B\u5173\u8054\u6570\u636E"),S=i("\uFF09\u3002"),C=n('<p>\u53C2\u8003\u6587\u6863\uFF1Ahttps://docs.microsoft.com/zh-cn/ef/core/querying/raw-sql</p><h2 id="_3-5-\u590D\u6742\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#_3-5-\u590D\u6742\u67E5\u8BE2" aria-hidden="true">#</a> 3.5 \u590D\u6742\u67E5\u8BE2</h2><p>\u6570\u636E\u5982\u4E0B\uFF1A</p><p>\u7528\u6237\u8868(user)</p><p><img src="https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1621562425951-13836b1a-66db-46a9-9f39-7fb3278d879c.png" alt="img"></p><p>\u7528\u6237\u6210\u7EE9\u8868(score)</p><p><img src="https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1621562455217-109ca102-03dc-41b3-9cc2-7c3e0a12856f.png" alt="img"></p><p>\u63CF\u8FF0\uFF1A\u5305\u542B\u4E09\u4E2A\u7528\u6237\uFF0C\u5176\u4E2D\u4E24\u4E2A\u7528\u6237\u5728\u6210\u7EE9\u8868\u90FD\u6709\u8BED\u6587\u548C\u6570\u5B66\u7684\u6570\u636E\u3002</p><h3 id="_3-5-1-\u5185\u8FDE\u63A5" tabindex="-1"><a class="header-anchor" href="#_3-5-1-\u5185\u8FDE\u63A5" aria-hidden="true">#</a> 3.5.1 \u5185\u8FDE\u63A5</h3><p>\u5185\u8FDE\u63A5\uFF1A\u5206\u4E3A\u9690\u5F0F\u5185\u8FDE\u63A5\u548C\u663E\u5F0F\u5185\u8FDE\u63A5(\u5199\u6CD5\u4E0D\u540C\uFF0C\u7ED3\u679C\u76F8\u540C)</p><h4 id="_3-5-1-1-linq\u67E5\u8BE2\u8868\u8FBE\u5F0F" tabindex="-1"><a class="header-anchor" href="#_3-5-1-1-linq\u67E5\u8BE2\u8868\u8FBE\u5F0F" aria-hidden="true">#</a> 3.5.1.1 Linq\u67E5\u8BE2\u8868\u8FBE\u5F0F</h4><h5 id="\u663E\u5F0F\u5185\u8FDE\u63A5-join-in-on\u62FC\u63A5" tabindex="-1"><a class="header-anchor" href="#\u663E\u5F0F\u5185\u8FDE\u63A5-join-in-on\u62FC\u63A5" aria-hidden="true">#</a> \u663E\u5F0F\u5185\u8FDE\u63A5\uFF1Ajoin-in-on\u62FC\u63A5</h5><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    var list = (from u in _context.Users\n                join sc in _context.Scores on u.Id equals sc.UserId\n                where sc.CourseName == &quot;\u8BED\u6587&quot;\n                select new\n                {\n                    u.Account,\n                    u.PassWord,\n                    sc.CourseName,\n                    sc.Grade\n                }).ToList();\n	Console.WriteLine(JsonConvert.SerializeObject(list));\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8BB0\u5F97\u5F15\u7528\uFF1ASystem.Linq \u5426\u5219\u63D0\u793A\uFF1A\u672A\u627E\u5230\u6E90\u7C7B\u578B\u201CDbSet&lt;User&gt;\u201D\u7684\u67E5\u8BE2\u6A21\u5F0F\u7684\u5B9E\u73B0\uFF0C\u672A\u627E\u5230join</p><p>\u751F\u6210SQL</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>      SELECT `u`.`Account`, `u`.`PassWord`, `s`.`CourseName`, `s`.`Grade`\n      FROM `user` AS `u`\n      INNER JOIN `score` AS `s` ON `u`.`Id` = `s`.`UserId`\n      WHERE `s`.`CourseName` = &#39;\u8BED\u6587&#39;\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C</p><p><img src="https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1621562254206-ca4cde94-2b2d-4e81-94fd-aabf09bc198d.png" alt="img"></p><p>\u4E09\u8868\u8054\u5408\u67E5\u8BE2</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>var templateFieldList = await (from template in _conclusionTemplateReq.EntitiesAsNoTracking.Where(t =&gt;\n        t.Isdefault &amp;&amp; t.TenantId == CurrentUser.TenantId)\n    join templateField in _templateFieldMappingRep.EntitiesAsNoTracking on template.CluTemplateId equals\n        templateField.CluTemplateId\n    join field in _conclusionTemplateFieldRep.EntitiesAsNoTracking.Where(t =&gt; t.Isdefault) on templateField\n        .CluFieldId equals field.CluFieldId\n    select new ChatConclusionTemplateFieldMapping(newTemplateId, templateField.CluFieldId,\n        templateField.Sort)).ToArrayAsync().ConfigureAwait(false);\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="\u9690\u5F0F\u5185\u8FDE\u63A5-\u591A\u4E2Afrom\u5E76\u8054\u62FC\u63A5" tabindex="-1"><a class="header-anchor" href="#\u9690\u5F0F\u5185\u8FDE\u63A5-\u591A\u4E2Afrom\u5E76\u8054\u62FC\u63A5" aria-hidden="true">#</a> \u9690\u5F0F\u5185\u8FDE\u63A5\uFF1A\u591A\u4E2Afrom\u5E76\u8054\u62FC\u63A5</h5><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    var list = (from u in _context.Users\n                from sc in _context.Scores\n                where u.Id == sc.UserId &amp;&amp; sc.CourseName == &quot;\u8BED\u6587&quot;\n                select new\n                {\n                    u.Account,\n                    u.PassWord,\n                    sc.CourseName,\n                    sc.Grade\n                }).ToList();\n    Console.WriteLine(JsonConvert.SerializeObject(list));\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u751F\u6210SQL</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>      SELECT `u`.`Account`, `u`.`PassWord`, `s`.`CourseName`, `s`.`Grade`\n      FROM `user` AS `u`\n      CROSS JOIN `score` AS `s`\n      WHERE (`u`.`Id` = `s`.`UserId`) AND (`s`.`CourseName` = &#39;\u8BED\u6587&#39;)\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C</p><p><img src="https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1621562264762-9127dd6f-a5bc-473f-bbc1-6547657eb5b5.png" alt="img"></p><h4 id="_3-5-1-2-linq\u6807\u51C6\u67E5\u8BE2\u8FD0\u7B97\u7B26" tabindex="-1"><a class="header-anchor" href="#_3-5-1-2-linq\u6807\u51C6\u67E5\u8BE2\u8FD0\u7B97\u7B26" aria-hidden="true">#</a> 3.5.1.2 Linq\u6807\u51C6\u67E5\u8BE2\u8FD0\u7B97\u7B26</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    var list = _context.Users.Where(t =&gt; t.Account != null)\n        .Join(_context.Scores.Where(sc =&gt; sc.CourseName == &quot;\u8BED\u6587&quot;), u =&gt; u.Id, sc =&gt; sc.UserId, (u, sc) =&gt; new\n        {\n            u.Account,\n            u.PassWord,\n            sc.CourseName,\n            sc.Grade\n        }).ToList();\n    Console.WriteLine(JsonConvert.SerializeObject(list));\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u751F\u6210SQL</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>      # \u4E0D\u52A0\u67E5\u8BE2\u8BFE\u7A0B\n	    SELECT `u`.`Account`, `u`.`PassWord`, `s`.`CourseName`, `s`.`Grade`\n      FROM `user` AS `u`\n      INNER JOIN `score` AS `s` ON `u`.`Id` = `s`.`UserId`\n      \n      # \u67E5\u8BE2\u8BFE\u7A0B\n      SELECT `u`.`Account`, `u`.`PassWord`, `t`.`CourseName`, `t`.`Grade`\n      FROM `user` AS `u`\n      INNER JOIN (\n          SELECT `s`.`CourseName`, `s`.`Grade`, `s`.`UserId`\n          FROM `score` AS `s`\n          WHERE `s`.`CourseName` = &#39;\u8BED\u6587&#39;\n      ) AS `t` ON `u`.`Id` = `t`.`UserId`\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C</p><p><img src="https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1621564709433-98fbb56e-66e0-4505-b414-b12e9fa5d53b.png" alt="img"></p><h3 id="_3-5-2-\u5916\u8FDE\u63A5" tabindex="-1"><a class="header-anchor" href="#_3-5-2-\u5916\u8FDE\u63A5" aria-hidden="true">#</a> 3.5.2 \u5916\u8FDE\u63A5</h3><p>\u5916\u8FDE\u63A5join\u540E\u5FC5\u987B\u6709into\uFF0C\u7136\u540E\u53EF\u4EE5\u52A0\u4E0AXX.DefaultIfEmpty()\uFF0C\u8868\u793A\u5BF9\u4E8E\u5F15\u7528\u7C7B\u578B\u5C06\u8FD4\u56DEnull,\u800C\u5BF9\u4E8E\u503C\u7C7B\u578B\u5219\u8FD4\u56DE0\u3002\u5BF9\u4E8E\u7ED3\u6784\u4F53\u7C7B\u578B\uFF0C\u5219\u4F1A\u6839\u636E\u5176\u6210\u5458\u7C7B\u578B\u5C06\u5B83\u4EEC\u76F8\u5E94\u5730\u521D\u59CB\u5316\u4E3Anull(\u5F15\u7528\u7C7B\u578B)\u62160(\u503C\u7C7B\u578B)\uFF0C</p><p>\u5982\u679C\u4EC5\u9700\u8981\u7EDF\u8BA1\u53F3\u8868\u7684\u4E2A\u6570\u6216\u8005\u5176\u5B83\u5C5E\u6027\uFF0C\u53EF\u4EE5\u7701\u7565XX.DefaultIfEmpty, \u4F46\u5982\u679C\u9700\u8981\u70B9\u51FA\u6765\u53F3\u8868\u7684\u5B57\u6BB5\uFF0C\u5219\u4E0D\u80FD\u7701\u3002</p><h4 id="_3-5-2-1-linq\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_3-5-2-1-linq\u5B9E\u73B0" aria-hidden="true">#</a> 3.5.2.1 linq\u5B9E\u73B0</h4><p>\u67E5\u8BE2\u6240\u6709\u7528\u6237\u5BF9\u5E94\u7684\u73ED\u7EA7,\u56E0\u4E3A\u7528\u6237\u548C\u6210\u7EE9\u4E00\u5BF9\u591A\uFF0C\u6240\u4EE5\u4F1A\u51FA\u73B0\u591A\u6761\u6570\u636E</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    var list = (from u in _context.Users\n                join sc in _context.Scores on u.Id equals sc.UserId\n                into ulist\n                from sco in ulist.DefaultIfEmpty()\n                where u.Account != null //\u8FD9\u4E2A\u6761\u4EF6\u53EA\u662F\u5C55\u793A\u5982\u4F55\u6DFB\u52A0\u6761\u4EF6\n                select new\n                {\n                    UserId = u.Id,\n                    Account = u.Account,\n                    sco.CourseName\n                }).ToList();\n    Console.WriteLine(JsonConvert.SerializeObject(list));\n\n            var list = (from g in _groupdefRep.EntitiesAsNoTracking\n                        join cl in _clouduserRep.EntitiesAsNoTracking on g.CloudId equals cl.Id\n                        into glist\n                        from c in glist.DefaultIfEmpty()\n                        where g.Enabled.Value == 1 &amp;&amp; (cloudId == 0 || g.CloudId == cloudId)\n                        orderby c.Id, g.GroupName\n                        select new\n                        {\n                            Gid = g.Id,\n                            Name = c == null ? g.GroupName : c.CloudName\n                        }).ToList();\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u4F7F\u7528\uFF1Astring.IsNullOrEmpty \u4E0D\u80FD\u4F7F\u7528\uFF1Astring.IsNullOrWhiteSpace</p><p>\u751F\u6210SQL</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>      SELECT `u`.`Id` AS `UserId`, `u`.`Account`, `s`.`CourseName`\n      FROM `user` AS `u`\n      LEFT JOIN `score` AS `s` ON `u`.`Id` = `s`.`UserId`\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C</p><p><img src="https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1621563339181-f19d1904-de1f-4897-a64c-d14e45f17071.png" alt="img"></p><p>\u5982\u679C\u8981\u67E5\u8BE2\u6210\u7EE9\uFF0C\u5E94\u8BE5\u8FD9\u4E48\u5199\uFF0C\u4E0A\u9762\u90A3\u4E2A\u5199\u6CD5\u4F1A\u76F4\u63A5\u62A5\u9519\uFF0C Nullable object must have a value</p><p><img src="https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1621563656968-030835ff-2188-43c9-99e6-b2c475e02f3e.png" alt="img"></p><h3 id="_3-5-3-groupjoin" tabindex="-1"><a class="header-anchor" href="#_3-5-3-groupjoin" aria-hidden="true">#</a> 3.5.3 GroupJoin</h3><p>GroupJoin\u64CD\u4F5C\u7B26\u5E38\u5E94\u7528\u4E8E\u8FD4\u56DE\u201C\u4E3B\u952E\u5BF9\u8C61-\u5916\u952E\u5BF9\u8C61\u96C6\u5408\u201D\u5F62\u5F0F\u7684\u67E5\u8BE2\uFF0C\u4F8B\u5982\u201C\u7528\u6237\u4FE1\u606F-\u6B64\u7528\u6237\u4E0B\u6240\u6709\u79D1\u76EE\u6210\u7EE9\u201D</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    var list = _context.Users.Where(t =&gt; t.Account != null)\n        .GroupJoin(_context.Scores, u =&gt; u.Id, sc =&gt; sc.UserId, (u, sc) =&gt; new\n        {\n            u.Account,\n            u.PassWord,\n            Scores = sc\n        }).ToList();\n    Console.WriteLine(JsonConvert.SerializeObject(list));\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8BE5\u4EE3\u7801\u4F1A\u63D0\u793A\u9519\u8BEF\uFF0C\u539F\u56E0\u5982\uFF1Ahttps://docs.microsoft.com/zh-cn/ef/core/querying/client-eval</p><h3 id="_3-5-4-grouby" tabindex="-1"><a class="header-anchor" href="#_3-5-4-grouby" aria-hidden="true">#</a> 3.5.4 GrouBy</h3><p>\u5206\u7EC4\u64CD\u4F5C \u6839\u636E\u7528\u6237\u5206\u7EC4\uFF0C\u6C42\u79D1\u76EE\u6570</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    var list = (from sc in _context.Scores\n                group sc by sc.UserId\n                into g\n                select new\n                {\n                    g.Key,\n                    Count = g.Count()\n                }).ToList();\n    Console.WriteLine(JsonConvert.SerializeObject(list));\n\n    var list2 = _context.Scores.GroupBy(sc =&gt; sc.UserId).Select(t =&gt; new\n    {\n        t.Key,\n        Count = t.Count()\n    }).ToList();\n    Console.WriteLine(JsonConvert.SerializeObject(list2));\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u751F\u6210SQL</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>info: Microsoft.EntityFrameworkCore.Database.Command[20101]\n      Executed DbCommand (1ms) [Parameters=[], CommandType=&#39;Text&#39;, CommandTimeout=&#39;30&#39;]\n      SELECT `s`.`UserId` AS `Key`, COUNT(*) AS `Count`\n      FROM `score` AS `s`\n      GROUP BY `s`.`UserId`\n[{&quot;Key&quot;:&quot;1395392302788120576&quot;,&quot;Count&quot;:2},{&quot;Key&quot;:&quot;1395392303090110464&quot;,&quot;Count&quot;:2}]\ninfo: Microsoft.EntityFrameworkCore.Database.Command[20101]\n      Executed DbCommand (0ms) [Parameters=[], CommandType=&#39;Text&#39;, CommandTimeout=&#39;30&#39;]\n      SELECT `s`.`UserId` AS `Key`, COUNT(*) AS `Count`\n      FROM `score` AS `s`\n      GROUP BY `s`.`UserId`\n[{&quot;Key&quot;:&quot;1395392302788120576&quot;,&quot;Count&quot;:2},{&quot;Key&quot;:&quot;1395392303090110464&quot;,&quot;Count&quot;:2}]\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-6-\u67E5\u8BE2\u662F\u5426\u5B58\u5728" tabindex="-1"><a class="header-anchor" href="#_3-6-\u67E5\u8BE2\u662F\u5426\u5B58\u5728" aria-hidden="true">#</a> 3.6 \u67E5\u8BE2\u662F\u5426\u5B58\u5728</h2><p>\u7B80\u5355\u67E5\u8BE2\u662F\u5426\u5B58\u5728</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>var exist = await _templateFieldMappingRep.EntitiesAsNoTracking.AnyAsync(t =&gt; t.CluFieldId == 111);\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8054\u8868\u67E5\u8BE2\u662F\u5426\u5B58\u5728</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>var existTitle =\n    await (from templatefield in _templateFieldMappingRep.EntitiesAsNoTracking.Where(t =&gt;\n            t.CluTemplateId == dto.CluTemplateId)\n            from field in _conclusionTemplateFieldRep.EntitiesAsNoTracking.Where(t =&gt;\n                t.FieldName == dto.FieldName)\n            where templatefield.CluFieldId == field.CluFieldId\n            select new { field.CluFieldId }).AnyAsync().ConfigureAwait(false);\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_4-\u6DFB\u52A0" tabindex="-1"><a class="header-anchor" href="#_4-\u6DFB\u52A0" aria-hidden="true">#</a> 4. \u6DFB\u52A0</h1><h2 id="_4-1-\u57FA\u7840\u6DFB\u52A0" tabindex="-1"><a class="header-anchor" href="#_4-1-\u57FA\u7840\u6DFB\u52A0" aria-hidden="true">#</a> 4.1 \u57FA\u7840\u6DFB\u52A0</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>  	_context.Movie.Add(movie);\n	// or\n	await _context.Movie.AddRangeAsync(movies)\n    await _context.SaveChangesAsync();\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-2-\u5DF2\u7ECF\u8BBE\u7F6E\u81EA\u589E\u952E\u7684\u63D2\u5165" tabindex="-1"><a class="header-anchor" href="#_4-2-\u5DF2\u7ECF\u8BBE\u7F6E\u81EA\u589E\u952E\u7684\u63D2\u5165" aria-hidden="true">#</a> 4.2 \u5DF2\u7ECF\u8BBE\u7F6E\u81EA\u589E\u952E\u7684\u63D2\u5165</h2><p>\u5148\u5173\u95ED\u81EA\u589E\u7136\u540E\u63D2\u5165\u6570\u636E\u540E\u518D\u5F00\u542F\u81EA\u589E</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>		db.Database.OpenConnection();\n        db.Database.ExecuteSqlCommand(&quot;SET IDENTITY_INSERT [T_RoleInfor] ON&quot;);\n        var r2 = new T_RoleInfor()\n        {\n            id = 123,\n            roleName = &quot;\u7BA1\u7406\u5458&quot;,\n            roleDescription = &quot;\u6211\u662F\u7BA1\u7406\u5458&quot;\n            };\n        db.Add(r2);\n        int count2 = db.SaveChanges();\n        db.Database.ExecuteSqlCommand(&quot;SET ID	ENTITY_INSERT [T_RoleInfor] OFF&quot;);\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-3-\u901A\u8FC7sql\u6DFB\u52A0" tabindex="-1"><a class="header-anchor" href="#_4-3-\u901A\u8FC7sql\u6DFB\u52A0" aria-hidden="true">#</a> 4.3 \u901A\u8FC7SQL\u6DFB\u52A0</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    var strSql2 = &quot;INSERT INTO `userinfo`(`Id`, `Account`, `PassWord`) VALUES (@id, @account, @password);&quot;;\n    var parameter2 = new MySqlParameter[] {\n        new MySqlParameter(&quot;@id&quot;,&quot;22&quot;),\n        new MySqlParameter(&quot;@account&quot;,&quot;2222&quot;),\n        new MySqlParameter(&quot;@password&quot;,&quot;22222&quot;)\n        };\n    var flg = db.Database.ExecuteSqlRaw(strSql2, parameter2);\n\n	// \u8C03\u7528\u5B58\u50A8\u8FC7\u7A0B\n	int n = db.Database.ExecuteSqlCommand(&quot;DoSome @id&quot;, para);//\u53C2\u6570\u5316\u67E5\u8BE2\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2.x\u4F7F\u7528ExecuteSqlCommand\uFF0C3.x\u4F7F\u7528ExecuteSqlRaw\u65B9\u6CD5</p><h1 id="_5-\u4FEE\u6539" tabindex="-1"><a class="header-anchor" href="#_5-\u4FEE\u6539" aria-hidden="true">#</a> 5. \u4FEE\u6539</h1><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    var  movie = await _context.Movie.FirstOrDefaultAsync(m =&gt; m.ID == id);\n    movie.Name=&quot;\u674E\u601D&quot;;\n    await _context.SaveChangesAsync();  \n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_6-\u5220\u9664" tabindex="-1"><a class="header-anchor" href="#_6-\u5220\u9664" aria-hidden="true">#</a> 6. \u5220\u9664</h1><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    var movie = await _context.Movie.FirstOrDefaultAsync(m =&gt; m.ID == id);\n    _context.Movie.Remove(movie);\n    await _context.SaveChangesAsync();\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_7-\u53C2\u8003\u6587\u6863" tabindex="-1"><a class="header-anchor" href="#_7-\u53C2\u8003\u6587\u6863" aria-hidden="true">#</a> 7. \u53C2\u8003\u6587\u6863</h1><p>\u5B98\u65B9\u4F8B\u5B50\uFF1Ahttps://docs.microsoft.com/zh-cn/ef/core/dbcontext-configuration/</p>',74);function I(A,y){const s=r("ExternalLinkIcon");return a(),l("div",null,[o,e("p",null,[c,e("a",v,[m,t(s)])]),b,e("ul",null,[p,g,e("li",null,[e("p",null,[h,q,x,e("a",f,[_,t(s)]),S])])]),C])}const T=d(u,[["render",I],["__file","efcoreoperation.html.vue"]]);export{T as default};
