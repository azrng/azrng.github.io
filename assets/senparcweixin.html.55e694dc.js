import{_ as t,o as a,c as d,b as e,e as s,d as n,a as r,r as l}from"./app.565765f9.js";const c={},u=e("h1",{id:"\u5F00\u7BC7\u8BED",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#\u5F00\u7BC7\u8BED","aria-hidden":"true"},"#"),n(" \u5F00\u7BC7\u8BED")],-1),o=n("\u57286\u67085\u53F7\uFF0C\u6211\u62A5\u540D\u53BB\u53C2\u52A0\u4E86\u5FAE\u8F6F\u4E3E\u529E\u7684\u4E00\u4E2A\u7EBF\u4E0B\u5206\u4EAB\u7684\u6280\u672F\u5E02\u96C6\uFF0C\u5206\u4EAB\u4EBA\u662F\u82CF\u8001\u5E08\u548C\u8D75\u8001\u5E08(\u975E\u5E38\u611F\u8C22)\uFF0C\u5176\u4E2D\u82CF\u8001\u5E08\u8BB2\u8FF0\u4E86\u5173\u4E8E\u4E00\u4E9B\u5BB9\u5668\u7684\u90E8\u7F72\u7B49\u64CD\u4F5C(\u4E5F\u53EF\u4EE5\u89C2\u770B\u6211\u7684"),v={href:"https://mp.weixin.qq.com/s/lJw7VIM5HnGFsn0eA2V2Fg",target:"_blank",rel:"noopener noreferrer"},m=n("\u5386\u53F2\u6587\u7AE0"),p=n(")\uFF0C\u5176\u4E2D\u5173\u4E8E\u90E8\u7F72\u7684\u793A\u4F8B\u4EE3\u7801\u662F\u4F7F\u7528\u76DB\u6D3E\u5FAE\u4FE1SDK\u505A\u4E86\u4E00\u4E2A\u5BF9\u63A5\u5FAE\u4FE1\u56DE\u590D\u6D88\u606F\u7684\u52A8\u80FD\uFF0C\u53C8\u4E00\u6B21\u5F15\u8D77\u4E86\u6211\u7684\u597D\u5947(\u4E4B\u524D\u662F\u81EA\u5DF1\u770B\u5FAE\u4FE1\u6587\u6863\u5BF9\u63A5\u3001\u8FDB\u884C\u914D\u7F6E\u9A8C\u8BC1\u4FDD\u5B58access_token\u7B49\u64CD\u4F5C)\uFF0C\u901A\u8FC7\u8BE5sdk\u53EF\u4EE5\u5E2E\u52A9\u6211\u4EEC\u7701\u4E0B\u4E0D\u5C11\u4E8B\u60C5\u6765\u8BA9\u6211\u4EEC\u5C11\u52A0\u73ED\u3002\u4E0B\u9762\u6211\u5C31\u901A\u8FC7\u8BE5sdk\u6765\u5B9E\u73B0\u4E24\u4E2A\u7B80\u5355\u7684\u529F\u80FD\u3002"),b=e("h1",{id:"\u4ECB\u7ECD",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#\u4ECB\u7ECD","aria-hidden":"true"},"#"),n(" \u4ECB\u7ECD")],-1),g=e("p",null,"Senparc.Weixin SDK \u662F\u7531\u76DB\u6D3E\u7F51\u7EDC\uFF08Senparc\uFF09\u56E2\u961F\u81EA\u4E3B\u7814\u53D1\u7684\u9488\u5BF9\u5FAE\u4FE1\u5404\u6A21\u5757\u7684\u5F00\u53D1\u5957\u4EF6\uFF08C# SDK\uFF09\uFF0C\u5DF2\u5168\u9762\u652F\u6301\u5FAE\u4FE1\u516C\u4F17\u53F7\u3001\u5C0F\u7A0B\u5E8F\u3001\u5FAE\u4FE1\u652F\u4ED8\u3001\u4F01\u4E1A\u53F7\u3001\u5F00\u653E\u5E73\u53F0\u3001JSSDK\u3001\u6447\u4E00\u6447\u5468\u8FB9\u7B49\u6A21\u5757\u3002\u6709\u4E00\u4E9B\u4E1C\u897F\u90FD\u5DF2\u7ECF\u5C01\u4F4F\u5728sdk\u91CC\u9762\uFF0C\u4E0D\u9700\u8981\u6211\u4EEC\u518D\u8FDB\u884C\u90A3\u4E9B\u7E41\u7410\u7684\u64CD\u4F5C\u3002",-1),x=e("h1",{id:"\u793A\u4F8B",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#\u793A\u4F8B","aria-hidden":"true"},"#"),n(" \u793A\u4F8B")],-1),q=n("\u8981\u5BF9\u63A5\u5FAE\u4FE1\u516C\u4F17\u53F7\uFF0C\u6211\u4EEC\u9996\u5148\u5F97\u6709\u4E00\u4E2A\u5FAE\u4FE1\u516C\u4F17\u53F7(\u6211\u672C\u6765\u662F\u4F7F\u7528\u6211\u81EA\u5DF1\u516C\u4F17\u53F7\uFF0C\u5948\u4F55\u597D\u591A\u597D\u73A9\u7684\u529F\u80FD\u6CA1\u6709\u6743\u9650\u9700\u8981\u5FAE\u4FE1\u8BA4\u8BC1)\uFF0C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7\u5FAE\u4FE1\u7533\u8BF7\u6D4B\u8BD5\u53F7\u6765\u5B66\u4E60\u4F7F\u7528\uFF0C"),h={href:"https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login",target:"_blank",rel:"noopener noreferrer"},S=n("\u7533\u8BF7\u5730\u5740"),_=n(" \u8BE5\u6D4B\u8BD5\u53F7\u53EF\u4EE5\u76F4\u63A5\u4F53\u9A8C\u548C\u6D4B\u8BD5\u516C\u4F17\u5E73\u53F0\u7684\u6240\u6709\u9AD8\u7EA7\u63A5\u53E3\u3002"),f=r(`<p>\u901A\u8FC7\u6D4B\u8BD5\u53F7\u6211\u53EF\u4EE5\u53EF\u4EE5\u5F97\u5230\u6211\u4EEC\u60F3\u8981\u7684\u5FAE\u4FE1\u516C\u4F17\u53F7\u53C2\u6570\u4FE1\u606F</p><p><img src="https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1622977807220-78a866b0-28df-4610-bd9e-4f1f9aa698f1.png" alt="img"></p><p>\u901A\u8FC7VS2019(\u597D\u60F3\u5C3D\u5FEB\u4F53\u9A8CVS2022)\u65B0\u5EFA\u4E00\u4E2A.Net5 WebApi\u7A0B\u5E8F</p><p>\u5B89\u88C5\u7EC4\u4EF6</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    &lt;PackageReference Include=&quot;RestSharp&quot; Version=&quot;106.11.7&quot; /&gt; 
    &lt;PackageReference Include=&quot;Senparc.Weixin.MP&quot; Version=&quot;16.12.101-preview2&quot; /&gt;
    &lt;PackageReference Include=&quot;Senparc.Weixin.MP.Middleware&quot; Version=&quot;0.3.100.1-preview2&quot; /&gt;
    &lt;PackageReference Include=&quot;Swashbuckle.AspNetCore&quot; Version=&quot;5.6.3&quot; /&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E3A\u4E86\u65B9\u4FBF(\u5077\u61D2)\uFF0C\u6211\u76F4\u63A5\u4F7F\u7528\u4E86postman\u751F\u6210\u7684RestSharp\u8BF7\u6C42\u4EE3\u7801\uFF0C\u56E0\u6B64\u88C5\u4E86\u8BE5\u5305\u3002</p><p>\u6DFB\u52A0\u914D\u7F6E</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>  //CO2NET 
  &quot;SenparcSetting&quot;: {
    &quot;IsDebug&quot;: true,
    &quot;DefaultCacheNamespace&quot;: &quot;DefaultCache&quot; //\u7F13\u5B58\u901A\u8FC7\u524D\u7F00\u533A\u5206
  },
  //Senparc.Weixin SDK
  &quot;SenparcWeixinSetting&quot;: {
    &quot;IsDebug&quot;: true,

    &quot;Token&quot;: &quot;token&quot;,
    &quot;EncodingAESKey&quot;: &quot;EncodingAESKey&quot;,
    &quot;WeixinAppId&quot;: &quot;appid&quot;,
    &quot;WeixinAppSecret&quot;: &quot;secret&quot;
  }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u901A\u8FC7\u914D\u7F6EIsDebug\u53EF\u4EE5\u914D\u7F6E\u662F\u5426\u4EE5Debug\u6A21\u5F0F\u8FD0\u884C\u3002</p><p>\u5173\u4E8ESenparcWeixinSetting\u4E3A\u4F55\u53EB\u505A\u8FD9\u4E2A\u540D\u5B57\uFF1F\u662F\u56E0\u4E3A\u914D\u7F6E\u4E2D\u5199\u6B7B\u7684</p><p><img src="https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1622978225760-721152c0-a511-4eb2-a614-eecfe6041bd0.png" alt="img"></p><p>ConfigureServices\u4E2D\u6CE8\u518C\u670D\u52A1</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    services.AddMemoryCache()//\u4F7F\u7528\u672C\u5730\u7F13\u5B58\u5FC5\u987B\u6DFB\u52A0
            .AddSenparcWeixinServices(Configuration);//Senparc.Weixin \u6CE8\u518C\uFF08\u5FC5\u987B\uFF09
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E5F\u53EF\u4EE5\u91C7\u7528redis\u7B49\u5176\u4ED6\u65B9\u6CD5\u5B58\u50A8\u914D\u7F6E\u4FE1\u606F\u7B49</p><p>Configure\u4E2D\u542F\u7528\u670D\u52A1</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    //\u6CE8\u518C Senparc.Weixin \u53CA\u57FA\u7840\u5E93
    app.UseSenparcGlobal(env, senparcSetting.Value, _ =&gt; { }, true)
        .UseSenparcWeixin(senparcWeixinSetting.Value,
            weixinRegister =&gt; weixinRegister.RegisterMpAccount(senparcWeixinSetting.Value));
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u901A\u8FC7\u8FD9\u4E9B\u914D\u7F6E\u6211\u4EEC\u53EF\u4EE5\u83B7\u53D6accesstoken</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>var accessToken = await AccessTokenContainer.GetAccessTokenAsync(_configuration[&quot;SenparcWeixinSetting:WeixinAppId&quot;]).ConfigureAwait(false);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="\u81EA\u5B9A\u4E49\u6D88\u606F\u56DE\u590D" tabindex="-1"><a class="header-anchor" href="#\u81EA\u5B9A\u4E49\u6D88\u606F\u56DE\u590D" aria-hidden="true">#</a> \u81EA\u5B9A\u4E49\u6D88\u606F\u56DE\u590D</h2><p>\u8981\u5B9E\u73B0\u63A5\u53D7\u7528\u6237\u7684\u6D88\u606F\uFF0C\u5E76\u4E14\u505A\u51FA\u56DE\u5E94\uFF0C\u6211\u4EEC\u9700\u8981\u7EE7\u627FMessageHandler&lt;DefaultMpMessageContext&gt;\uFF0C\u65B0\u5EFACustomerMessageHandler\u7C7B\uFF0C\u8BE5\u7C7B\u4E2D\u5B9E\u73B0\u4E86\u7F51\u4E0A\u8BF4\u7684\u4EF7\u503C\u4E00\u4E2A\u4EBF\u7684AI\u6838\u5FC3\u4EE3\u7801\uFF0C\u770B\u5230\u5C31\u662F\u8D5A\u5230\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    /// &lt;summary&gt;
    /// \u81EA\u5B9A\u4E49\u6D88\u606F\u5904\u7406\u5668
    /// &lt;/summary&gt;
    public class CustomerMessageHandler : MessageHandler&lt;DefaultMpMessageContext&gt;
    {
        public CustomerMessageHandler(Stream inputStream, PostModel postModel, int maxRecordCount = 0, IServiceProvider serviceProvider = null)
            : base(inputStream, postModel, maxRecordCount, false, null)
        {
        }

        /// &lt;summary&gt;
        /// \u56DE\u590D\u4EE5\u6587\u5B57\u5F62\u5F0F\u53D1\u9001\u7684\u4FE1\u606F\uFF08\u53EF\u9009\uFF09
        /// &lt;/summary&gt;
        public override async Task&lt;IResponseMessageBase&gt; OnTextRequestAsync(RequestMessageText requestMessage)
        {
            var responseMessage = base.CreateResponseMessage&lt;ResponseMessageText&gt;();
            // await Senparc.Weixin.MP.AdvancedAPIs.CustomApi.SendTextAsync(Config.SenparcWeixinSetting.MpSetting.WeixinAppId, OpenId,);//\u6CE8\u610F\uFF1A\u53EA\u6709\u6D4B\u8BD5\u53F7\u6216\u90E8\u7F72\u5230\u6B63\u5F0F\u73AF\u5883\u7684\u6B63\u5F0F\u670D\u52A1\u53F7\u53EF\u7528\u6B64\u63A5\u53E3
            //responseMessage.Content =  $&quot;\u4F60\u53D1\u9001\u4E86\u6587\u5B57\uFF1A{requestMessage.Content}\\r\\n\\r\\n\u4F60\u7684OpenId\uFF1A{OpenId}&quot;;//\u4EE5\u6587\u5B57\u7C7B\u578B\u6D88\u606F\u56DE\u590D
            responseMessage.Content = requestMessage.Content.Replace(&quot;\u5417&quot;, &quot;&quot;).Replace(&#39;?&#39;, &#39;!&#39;).Replace(&#39;\uFF1F&#39;, &#39;!&#39;);
            return responseMessage;
        }

        /// &lt;summary&gt;
        /// \u9ED8\u8BA4\u6D88\u606F
        /// &lt;/summary&gt;
        public override IResponseMessageBase DefaultResponseMessage(IRequestMessageBase requestMessage)
        {
            var responseMessage = base.CreateResponseMessage&lt;ResponseMessageText&gt;();
            responseMessage.Content = &quot;\u6B22\u8FCE\u6765\u5230\u6211\u7684\u516C\u4F17\u53F7\uFF01&quot;;
            return responseMessage;
        }
    }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u542F\u7528\u6D88\u606F\u5904\u7406\u5668</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>            //\u4F7F\u7528\u4E2D\u95F4\u4EF6\u6CE8\u518C MessageHandler\uFF0C\u6307\u5B9A CustomMessageHandler \u4E3A\u81EA\u5B9A\u4E49\u5904\u7406\u65B9\u6CD5
            app.UseMessageHandlerForMp(&quot;/weixinmsg&quot;,
                (stream, postModel, maxRecordCount, serviceProvider) =&gt;
                    new CustomerMessageHandler(stream, postModel, maxRecordCount, serviceProvider),
                options =&gt; { options.AccountSettingFunc = context =&gt; senparcWeixinSetting.Value; });
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u4E2A\u65F6\u5019\u6211\u4EEC\u5DF2\u7ECF\u5B9E\u73B0\u4E86\u7528\u6237\u6D88\u606F\u7684\u63A5\u6536\u548C\u56DE\u590D\u4EE3\u7801\uFF0C\u4E0D\u8FC7\u8FD8\u9700\u8981\u5728\u5FAE\u4FE1\u5E73\u53F0\u8FDB\u884C\u914D\u7F6E(\u4E3A\u4E86\u53EF\u4EE5\u8BA9\u5FAE\u4FE1\u53D1\u9001\u6D88\u606F\u5230\u8BE5\u4EE3\u7801\uFF0C\u6211\u4F7F\u7528\u4E86\u5185\u7F51\u7A7F\u900F\u529F\u80FD\u4F9B\u5FAE\u4FE1\u8BBF\u95EE\u8BE5\u5730\u5740)</p><p><img src="https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1622979217988-39a0c9b9-baa7-4379-a1c3-b1f89335d857.png" alt="img"></p><p>\u5982\u679C\u4F60\u4FEE\u6539\u63A5\u53E3\u914D\u7F6E\u4FE1\u606F\uFF0C\u63D0\u4EA4\u6210\u529F\u8BF4\u660E\u5FAE\u4FE1\u53EF\u4EE5\u8C03\u901A\u8BE5\u63A5\u53E3\uFF0C\u8FD9\u4E2A\u65F6\u5019\u5C31\u53EF\u4EE5\u5173\u6CE8\u5FAE\u4FE1\u6D4B\u8BD5\u53F7\uFF0C\u53D1\u9001\u6D88\u606F\u67E5\u770B\u7ED3\u679C\u3002</p><p><img src="https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1622980346934-85e8991c-c6c2-419f-8980-479706c77db7.png" alt="img"></p><h2 id="\u81EA\u5B9A\u4E49\u83DC\u5355" tabindex="-1"><a class="header-anchor" href="#\u81EA\u5B9A\u4E49\u83DC\u5355" aria-hidden="true">#</a> \u81EA\u5B9A\u4E49\u83DC\u5355</h2><p>\u901A\u8FC7\u7F16\u5199\u63A5\u53E3\u6765\u5B9E\u73B0\u81EA\u5B9A\u4E49\u83DC\u5355\u914D\u7F6E</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>        [HttpGet]
        public async Task&lt;string&gt; GetAsync()
        {
            var accessToken = await AccessTokenContainer
                .GetAccessTokenAsync(_configuration[&quot;SenparcWeixinSetting:WeixinAppId&quot;]).ConfigureAwait(false);
            var bg = new ButtonGroup();

            var oneSubButton = new SubButton
            {
                name = &quot;\u57FA\u7840\u77E5\u8BC6&quot;,
                sub_button = new List&lt;SingleButton&gt;
                {
                    new SingleViewButton
                    {
                        name = &quot;\u65E5\u5FD7&quot;,
                        url = &quot;https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzU4MjU4NjgyOQ==&amp;action=getalbum&amp;album_id=1841538022157172741#wechat_redirect&quot;,
                    }
                }
            };
            bg.button.Add(oneSubButton);

            bg.button.Add(new SingleViewButton
            {
                name = &quot;\u6587\u7AE0\u76EE\u5F55&quot;,
                url = &quot;https://www.yuque.com/docs/share/9aed821e-9115-41c7-a0cd-6b691ad7e400&quot;
            });

            var result = CommonApi.CreateMenu(accessToken, bg);

            return &quot;\u6210\u529F&quot; + result;
        }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53C2\u8003\u5730\u5740\uFF1A</p><p>https://developers.weixin.qq.com/doc/offiaccount/Getting_Started/Overview.html</p><p>\u901A\u8FC7\u8C03\u7528\u8BE5\u63A5\u53E3\u5B9E\u73B0\u81EA\u5B9A\u4E49\u83DC\u5355\u914D\u7F6E\uFF0C\u663E\u793A\u4E0B\u9762\u7684\u83DC\u5355</p><p><img src="https://gitee.com/AZRNG/picture-storage/raw/master/kbms/1622981968228-c5836652-5d45-476a-805d-9bf4a2bf97fa.png" alt="img"></p><h1 id="\u53C2\u8003\u6587\u6863" tabindex="-1"><a class="header-anchor" href="#\u53C2\u8003\u6587\u6863" aria-hidden="true">#</a> \u53C2\u8003\u6587\u6863</h1><p>GitHub\uFF1Ahttps://github.com/JeffreySu/WeiXinMPSDK</p><p>sdk\u6587\u6863\u5730\u5740\uFF1Ahttps://www.cnblogs.com/szw/p/weixin-course-index.html</p><p>\u57FA\u672C\u4F7F\u7528\u6559\u7A0B\uFF1Ahttps://www.cnblogs.com/szw/p/3414732.html</p>`,38);function M(w,A){const i=l("ExternalLinkIcon");return a(),d("div",null,[u,e("p",null,[o,e("a",v,[m,s(i)]),p]),b,g,x,e("p",null,[q,e("a",h,[S,s(i)]),_]),f])}const k=t(c,[["render",M],["__file","senparcweixin.html.vue"]]);export{k as default};
